---
title: "Radio CovILD, 1-year follow-up"
subtitle: "Supplementary Material"
author: "CovILD study team"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
always_allow_html: true
output: 
  pdf_document:
    latex_engine: xelatex
bibliography: cov_biblio.bib
csl: elife.csl
header-includes:
  \usepackage{longtable}
  \usepackage{tabu}
  \usepackage{caption}
  \usepackage{makecell}
  \usepackage{pdflscape}
  \usepackage{array}
  \usepackage{booktabs}
  \usepackage{threeparttable}
  \usepackage{threeparttablex}
  \usepackage{wrapfig}
  \usepackage{multirow}
  \usepackage[normalem]{ulem}
  \usepackage{colortbl}
  \usepackage{xcolor}
  \usepackage{float} \floatplacement{figure}{H} \floatplacement{table}{H}
  \newcommand{\beginsupplement}{\setcounter{table}{0}  \renewcommand{\thetable}{S\arabic{table}}       \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
---

```{r, setup, include = FALSE}

library(bookdown)

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, dev = "cairo_pdf", ft_max_row = 6, tab.topcaption = TRUE, ft.align = "center")

set_flextable_defaults(font.size = 11, padding = 2)

use_df_printer()


```

\beginsupplement
\newpage

# Supplementary Tables

```{r tab-study-variables, tab.cap = 'Variables available for the analysis. The first 10 table records are shown. The full table is available as a supplementary Excel file.'}

suppl_tables$study_vars[1:10, ] %>% 
  flextable() %>% 
  width(1, width = 4, unit = 'cm') %>% 
  width(2:3, width = 2.5, unit = 'cm') %>% 
  width(4:5, width = 4, unit = 'cm')

```

\newpage

```{r tab-baseline-severity, tab.cap = 'Baseline characteristic of the acute COVID-19 severity subsets.'}

suppl_tables$baseline_severity %>% 
  flextable() %>%
  width(1, width = 1.8, unit = 'cm') %>% 
  width(2:5, width = 3.9, unit = 'cm') %>% 
  width(6, width = 2.5, unit = 'cm') %>% 
  footnote(i = 2:6, 
           j = 1, 
           value = as_paragraph('percentage of the acute COVID-19 severity subset (n individuals)'), 
           part = 'body', 
           ref_symbols = '1') %>% 
  footnote(i = 4, 
           j = 1, 
           value = as_paragraph('body mass index, kg/m\u00B2, overweight: > 25 kg/m\u00B2, obesity: > 30 kg/m\u00B2'), 
           part = 'body', 
           ref_symbols = '2') %>% 
  footnote(i = 5, 
           j = 1, 
           value = as_paragraph('packages per year'), 
           part = 'body', 
           ref_symbols = '3') %>% 
  footnote(i = 1, 
           j = 6, 
           value = as_paragraph('Kruskal-Wallis test for differences between the acute COVID-19 severity subsets, ns: not significant'), 
           part = 'body', 
           ref_symbols = '4') %>% 
  footnote(i = 2:6, 
           j = 6, 
           value = as_paragraph('\u03C7\u00B2 test for differences between the acute COVID-19 severity subsets, ns: not significant'), 
           part = 'body', 
           ref_symbols = '5') %>% 
  theme_vanilla

```

\newpage

```{r tab-ct-visits, tab.cap = 'Lung CT features in the acute COVID-19 severity subsets at the consecutive follow-up visits.'}

suppl_tables$ct_visits %>% 
  flextable() %>%
  width(1, width = 1.8, unit = 'cm') %>% 
  width(2, width = 2.7, unit = 'cm') %>% 
  width(3:6, width = 3.2, unit = 'cm') %>% 
  width(7, width = 2.5, unit = 'cm') %>% 
  merge_v(1) %>% 
  footnote(i = 1, 
           j = 3:6, 
           value = as_paragraph('percentage of the acute COVID-19 severity subset (n individuals), FUP: follow-up'), 
           part = 'header', 
           ref_symbols = '1') %>% 
  footnote(i = 1, 
           j = 7, 
           value = as_paragraph('\u03C7\u00B2 test for differences between the follow-ups, ns: not significant'), 
           part = 'header', 
           ref_symbols = '2') %>% 
  footnote(i = c(6, 21, 36, 51), 
           j = 2, 
           value = as_paragraph('ground glass opacity'), 
           part = 'body', 
           ref_symbols = '3') %>% 
  footnote(i = c(11, 26, 41, 56), 
           j = 2, 
           value = as_paragraph('acute respiratory distress syndrome'), 
           part = 'body', 
           ref_symbols = '4') %>% 
  footnote(i = c(12, 27, 42, 57), 
           j = 2, 
           value = as_paragraph('organizing pneumonia'), 
           part = 'body', 
           ref_symbols = '5') %>% 
  theme_vanilla

```

\newpage

```{r tab-ctss, tab.cap = 'CT severity score at the consecutive visits in the entire cohort and the acute COVID-19 severity subsets.'}

suppl_tables$ctss %>% 
  flextable() %>%
  width(1, width = 1.8, unit = 'cm') %>% 
  width(2:5, width = 3.5, unit = 'cm') %>% 
  width(6, width = 2.5, unit = 'cm') %>% 
  footnote(i = 1, 
           j = 2:5, 
           value = as_paragraph('FUP: follow-up'), 
           part = 'header', 
           ref_symbols = '1') %>% 
  footnote(i = 1, 
           j = 6, 
           value = as_paragraph('Kruskal-Wallis test for differences between the follow-ups, ns: not significant'), 
           part = 'header', 
           ref_symbols = '2') %>% 
  theme_vanilla

```

\newpage

```{r tab-opacity, tab.cap = 'Percentages of opacity and high opacity at the consecutive visits in the entire cohort and the acute COVID-19 severity subsets.'}

suppl_tables$opacity %>% 
  flextable() %>%
  width(1, width = 1.8, unit = 'cm') %>% 
  width(2, width = 1.8, unit = 'cm') %>% 
  width(3:6, width = 3.5, unit = 'cm') %>% 
  width(7, width = 2.5, unit = 'cm') %>% 
  merge_v(1) %>% 
  footnote(i = 1, 
           j = 3:6, 
           value = as_paragraph('FUP: follow-up'), 
           part = 'header', 
           ref_symbols = '1') %>% 
  footnote(i = 1, 
           j = 7, 
           value = as_paragraph('Kruskal-Wallis test for differences between the follow-ups, ns: not significant'), 
           part = 'header', 
           ref_symbols = '2') %>% 
  theme_vanilla

```

\newpage

# Supplementary Figures

```{r fig-ct-sev, fig.width = mm_inch(suppl_figures$ct_kinetic$w), fig.height = mm_inch(suppl_figures$ct_kinetic$h), dpi = 600, fig.cap = 'Resolution kinetic of moderate-to-severe lung CT abnormalities.'}

suppl_figures$ct_kinetic$plot

```

__Figure \@ref(fig:fig-ct-sev). Resolution kinetic of moderate-to-severe lung CT abnormalities.__

Risk of moderate-to-severe lung CT abnormalities (CT severity score > 5) at the consecutive time points was modeled by mixed-effect logistic regression (random effect: individual, fixed effect: time post COVID-19) in the entire cohort and the acute COVID-19 severity subsets. Significance of the fixed time term was determined by likelihood ratio test (LRT) versus the respective random effect-only null model.

__(A)__ Percents of individuals with moderate-to-severe CT abnormalities in the analyzed collectives. $\chi$ statistic, degrees of freedom and p values of the LRT test are presented in the plot captions. Numbers of individuals with the complete set of consecutive CT scans are shown under the plots.

__(B)__ Recovery between the consecutive follow-ups assessed by Kendall $\tau$ statistic.

\newpage

```{r fig-ct-opacity, fig.width = mm_inch(suppl_figures$ct_opacity$w), fig.height = mm_inch(suppl_figures$ct_opacity$h), dpi = 600, fig.cap = 'Resolution kinetic of lung CT opacity.'}

suppl_figures$ct_opacity$plot

```

__Figure \@ref(fig:fig-ct-opacity). Resolution kinetic of lung CT opacity.__

Risk of any lung CT opacity at the consecutive time points was modeled by mixed-effect logistic regression (random effect: individual, fixed effect: time post COVID-19) in the entire cohort and the acute COVID-19 severity subsets. Significance of the fixed time term was determined by likelihood ratio test (LRT) versus the respective random effect-only null model.

__(A)__ Percents of individuals with CT opacity in the analyzed collectives. $\chi$ statistic, degrees of freedom and p values of the LRT test are presented in the plot captions. Numbers of individuals with the complete set of consecutive CT scans are shown under the plots.

__(B)__ Recovery between the consecutive follow-ups assessed by Kendall $\tau$ statistic.

\newpage

```{r fig-opacity-kinetic, fig.width = mm_inch(suppl_figures$opacity_kinetic$w), fig.height = mm_inch(suppl_figures$opacity_kinetic$h), dpi = 600, fig.cap = 'Kinetic of the lung opacity.'}

suppl_figures$opacity_kinetic$plot

```

__Figure \@ref(fig:fig-opacity-kinetic). Kinetic of the lung opacity.__

Kinetic of the lung opacity at the consecutive time points was investigated by Friedman test (grouping by the individual) in the entire cohort and the acute COVID-19 severity subsets. The effect size was determined by Kendall W test, differences between particular time points were compared by Wilcoxon test.

__(A)__ Plots display individual opacity trajectories as thin gray lines, thick colored lines represent medians, interquartile ranges are presented as colored regions. $\chi$ statistic, degrees of freedom and p values of the Friedman test and the Kendall W statistic with 95$\%$ confidence intervals are presented in the plot captions. Numbers of individuals with the complete set of consecutive CT scans are shown under the plots.

__(B)__ Recovery between the consecutive follow-ups assessed by Kendall $\tau$ statistic.

\newpage

```{r fig-opacity-risk, fig.width = mm_inch(suppl_figures$opacity_risk$w), fig.height = mm_inch(suppl_figures$opacity_risk$h), dpi = 600, fig.cap = 'Risk of developing lung opacity at the one-year post-COVID-19 follow-up.'}

suppl_figures$opacity_risk$plot

```

__Figure \@ref(fig:fig-opacity-risk). Risk of developing lung opacity at the one-year post-COVID-19 follow-up.__

__(A)__ Risk factors of developing opacity at the one-year follow-up visit were identified by a series of logistic models. Odds ratio (OR) significance was determined by Wald Z test. OR with 95$\%$ confidence intervals are presented in a Forest plot. Numbers of complete observations and the reference levels of the explanatory variables are indicated in the Y axis.

__(B)__ Independent risk factors of opacity were identified by multi-parameter logistic modeling with backward elimination. OR significance was determined by Wald Z test. Model prediction was verified by 20-fold cross-validation (CV) and receiver-operating characteristic (ROC). OR with 95$\%$ confidence intervals are presented in a Forest plot. Area under the curve (AUC), sensitivity (Se) and specificity (Sp) for detection of opacity in CV are indicated in the plot caption. Numbers of complete observations and the reference levels of the explanatory variables are indicated in the Y axis.

Orange: positive correlation, blue: negative correlation, gray: not significant, BMI: body mass index, PKY: packages per year, ref.: reference.

\newpage

```{r fig-opacity-rater, fig.width = mm_inch(suppl_figures$any_abnormality_rater$w), fig.height = mm_inch(suppl_figures$any_abnormality_rater$h), dpi = 600, fig.cap = 'Performance of automated opacity assessment at detection of lung CT abnormalities.'}

suppl_figures$any_abnormality_rater$plot

```

__Figure \@ref(fig:fig-opacity-rater). Performance of automated opacity assessment at detection of lung CT abnormalities.__

Lung CT abnormality were defined either by the radiologist or by the software as opacity $\geq$ 1$\%$ lung volume. Performance of the opacity at detecting CT abnormalities was investigated at the consecutive follow-ups by receiver-operating characteristic (ROC) and Cohen's $\kappa$ statistic. Numbers of complete observations and CT abnormalities (events) are indicated under the plots.

__(A)__ ROC curves annotated with sensitivity (Se), specificity (Sp) and area under the curve (AUC) values with 95$\%$ confidence intervals.

__(B)__ $\kappa$ with 95$\%$ confidence intervals presented in a forest plot.

\newpage

```{r fig-ggo-rater, fig.width = mm_inch(suppl_figures$ggo_rater$w), fig.height = mm_inch(suppl_figures$ggo_rater$h), dpi = 600, fig.cap = 'Performance of automated opacity assessment at detection of GGO.'}

suppl_figures$ggo_rater$plot

```

__Figure \@ref(fig:fig-ggo-rater). Performance of automated opacity assessment at detection of GGO.__

Lung GGO were defined either by the radiologist or by the software as opacity $\geq$ 1$\%$ lung volume. Performance of the opacity at detecting GGO was investigated at the consecutive follow-ups by receiver-operating characteristic (ROC) and Cohen's $\kappa$ statistic. Numbers of complete observations and CT abnormalities (events) are indicated under the plots.

__(A)__ ROC curves annotated with sensitivity (Se), specificity (Sp) and area under the curve (AUC) values with 95$\%$ confidence intervals.

__(B)__ $\kappa$ with 95$\%$ confidence intervals presented in a forest plot.

\newpage

```{r fig-ctss-opacity, fig.width = mm_inch(suppl_figures$ctss_opacity$w), fig.height = mm_inch(suppl_figures$ctss_opacity$h), dpi = 600, fig.cap = 'Correlation of CTSS and lung opacity.'}

suppl_figures$ctss_opacity$plot

```

__Figure \@ref(fig:fig-ctss-opacity). Correlation of CTSS and lung opacity.__

Correlation of CTSS and lung opacity at the consecutive follow-ups was investigated with Spearman test. Points represent single observations, blue lines with gray regions represent fitted linear trend with 95$\%$ confidence interval. Correlation coefficients (r), p values and numbers of complete observations are indicated in the plot captions.